{
  "alert": "High CPU Usage",
  "alertType": "METRIC_BASED_ALERT",
  "severity": "warning",
  "ruleType": "threshold_rule",
  "evalWindow": "5m0s",
  "frequency": "1m0s",
  "broadcastToAll": true,
  "preferredChannels": ["019b9170-7e71-7dde-89c5-2c637c0d8646"],
  "disabled": false,
  "description": "Node CPU usage is above 90%",
  "summary": "High CPU usage detected",
  "labels": {
    "source": "gitops"
  },
  "condition": {
    "compositeQuery": {
      "builderQueries": {
        "A": {
          "queryName": "A",
          "dataSource": "metrics",
          "aggregateOperator": "avg",
          "aggregateAttribute": {
            "key": "k8s.node.cpu.usage",
            "dataType": "float64",
            "type": "Gauge",
            "isColumn": true
          },
          "filters": {
            "items": [],
            "op": "AND"
          },
          "groupBy": [
            {
              "key": "k8s.node.name",
              "dataType": "string",
              "type": "tag"
            }
          ],
          "expression": "A",
          "disabled": false,
          "stepInterval": 60
        },
        "B": {
          "queryName": "B",
          "dataSource": "metrics",
          "aggregateOperator": "latest",
          "aggregateAttribute": {
            "key": "k8s.node.allocatable_cpu",
            "dataType": "float64",
            "type": "Gauge",
            "isColumn": true
          },
          "filters": {
            "items": [],
            "op": "AND"
          },
          "groupBy": [
            {
              "key": "k8s.node.name",
              "dataType": "string",
              "type": "tag"
            }
          ],
          "expression": "B",
          "disabled": false,
          "stepInterval": 60
        },
        "F1": {
          "queryName": "F1",
          "expression": "(A / B) * 100",
          "disabled": false
        }
      },
      "panelType": "graph",
      "queryType": "builder"
    },
    "selectedQueryName": "F1",
    "matchType": "1",
    "target": 90,
    "op": "1"
  }
}
