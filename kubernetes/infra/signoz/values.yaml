namespace: signoz

syncPolicy:
  serverSideApply: true

# Ignore Kubernetes runtime defaults that cause perpetual drift
ignoreDifferences:
  # ClickHouse operator metrics-exporter adds divisor: "0" defaults to resourceFieldRef
  - group: apps
    kind: Deployment
    name: signoz-clickhouse-operator
    jqPathExpressions:
      - .spec.template.spec.containers[].env[].valueFrom.resourceFieldRef.divisor
  # StatefulSets get runtime defaults (revisionHistoryLimit, persistentVolumeClaimRetentionPolicy)
  - group: apps
    kind: StatefulSet
    name: signoz
    jqPathExpressions:
      - .spec.revisionHistoryLimit
      - .spec.persistentVolumeClaimRetentionPolicy
  - group: apps
    kind: StatefulSet
    name: signoz-zookeeper
    jqPathExpressions:
      - .spec.revisionHistoryLimit
      - .spec.persistentVolumeClaimRetentionPolicy

tailscale-ingress:
  enabled: true
  ingresses:
    - name: tailscale
      hostname: signoz
      service:
        name: signoz
        port: 8080

# API token for loading dashboards/alerts via GitOps
# Create token in SigNoz: Settings → API Tokens → Generate
# Store in Bitwarden and update the secret ID below
bitwarden-secret:
  enabled: true
  secrets:
    - name: signoz-api-token
      data:
        token: "fa8aa5d0-f1d2-4de3-a1a8-b3c9003c2a52"

signoz:
  clusterName: homelab

  # Use longhorn-emmc for all SigNoz PVCs (ClickHouse, Zookeeper, SigNoz DB)
  global:
    storageClass: longhorn-emmc

  clickhouse:
    persistence:
      enabled: true
      size: 20Gi
    podAnnotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "9363"
    zookeeper:
      heapSize: 256
      podAnnotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9141"
    clickhouseOperator:
      podAnnotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "8888"

  otelCollector:
    podAnnotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "8888"

  signoz:
    persistence:
      enabled: true
      size: 1Gi
