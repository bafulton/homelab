namespace: time-machine

# MetalLB LoadBalancer IP (from pool 192.168.0.200-250)
service:
  loadBalancerIP: "192.168.0.201"

# Storage configuration
# NVMe disk is ~1.9TB, so request 1.8Ti to leave headroom
storage:
  storageClass: longhorn-nvme
  size: 1800Gi

# Time Machine configuration
# Single shared account - per-machine quotas enforced via .quota.plist
timemachine:
  user: Family
  uid: 1000
  # Per-machine quota in bytes (900GB = 900000000000)
  # Each Mac gets this much space independently
  quotaBytes: 900000000000

# Samba image configuration
image:
  repository: mbentley/timemachine
  # renovate: datasource=docker depName=mbentley/timemachine
  tag: smb
  pullPolicy: IfNotPresent

# Bitwarden secrets for SMB password
bitwarden-secret:
  secrets:
    - name: time-machine-credentials
      data:
        # Reusing ben's password - can create a dedicated one later
        password: "a00db757-d2bf-495a-b33a-b3cf002ad2a3"

# mDNS advertisement for Time Machine auto-discovery
# IP must match service.loadBalancerIP above
mdnsServices:
  - name: Time Machine
    hostname: timemachine
    ip: 192.168.0.201
    port: 445
    types:
      # SMB file sharing
      - type: _smb._tcp
      # Apple disk service (required for Time Machine auto-discovery)
      # Single shared volume with per-machine quotas via .quota.plist
      - type: _adisk._tcp
        txtRecords:
          - "sys=adVF=0x100"
          - "dk0=adVN=Family,adVF=0x82"
      # Device info (shows as Time Capsule in Finder)
      - type: _device-info._tcp
        txtRecords:
          - "model=TimeCapsule8,119"
