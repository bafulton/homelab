namespace: argocd

tailscale-ingress:
  enabled: true
  ingresses:
    - name: tailscale
      hostname: argocd
      service:
        name: argocd-server
    - name: webhook
      hostname: argocd-webhook
      service:
        name: argocd-server
      funnel:
        enabled: true
        path: /api/webhook

# Bitwarden secrets pulled via ExternalSecret
bitwarden-secret:
  secrets:
    - name: argocd-github-webhook
      creationPolicy: Merge
      target:
        name: argocd-secret
      data:
        webhook.github.secret: "1386d7aa-4c3c-4e6e-ac7f-b3c70119021a"

argo-cd:
  # A complete list of values can be found here:
  # https://github.com/argoproj/argo-helm/blob/main/charts/argo-cd/values.yaml

  configs:
    secret:
      createSecret: false

    params:
      # Disable TLS on ArgoCD server - safe because it's behind Tailscale Ingress
      # which provides HTTPS termination. Do not expose directly to internet.
      server.insecure: true

  applicationSet:
    enabled: true

  # Expose metrics via dedicated services for Prometheus scraping
  controller:
    metrics:
      enabled: true
      service:
        enabled: true
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "8082"

  server:
    metrics:
      enabled: true
      service:
        enabled: true
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "8083"

  repoServer:
    metrics:
      enabled: true
      service:
        enabled: true
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "8084"
