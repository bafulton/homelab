namespace: traefik

traefik:
  # A complete list of values can be found here:
  # https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml
  #
  # Useful examples here:
  # https://github.com/traefik/traefik-helm-chart/blob/master/EXAMPLES.md

  priorityClassName: "system-cluster-critical"

  # High availability - 2 replicas for zero downtime
  replicas: 2

  # Ensure at least 1 pod is always available during disruptions
  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  # Enable Gateway API provider
  providers:
    kubernetesGateway:
      enabled: true

  # Configure standard HTTP/HTTPS ports
  ports:
    web:
      port: 80
      expose:
        default: true
        tailscale: true
    websecure:
      port: 443
      expose:
        default: true
        tailscale: true

  # Configure Gateway with listeners for both remote and LAN access
  gateway:
    enabled: true
    name: traefik  # Override default "traefik-gateway" for shorter name
    listeners:
      web:
        port: 80
        protocol: HTTP
        namespacePolicy:
          from: All
      websecure:
        port: 443
        protocol: HTTPS
        namespacePolicy:
          from: All
        certificateRefs:
          - name: wildcard-catfish-mountain-com-tls
        mode: Terminate

  # Prometheus annotations for auto-discovery by signoz-k8s-infra
  deployment:
    podAnnotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "9100"

  # MetalLB LoadBalancer IP (from pool 192.168.0.200-250)
  service:
    annotations:
      metallb.io/loadBalancerIPs: "192.168.0.200"
    # Additional service - Tailscale for remote access
    additionalServices:
      tailscale:
        type: LoadBalancer
        loadBalancerClass: tailscale
        annotations:
          tailscale.com/hostname: cluster-gateway

  additionalArguments:
    # Expose dashboard without TLS - safe because it's behind Gateway API
    # Do not expose directly to internet.
    - "--api.insecure=true"

  # Enable metrics endpoint
  metrics:
    prometheus:
      service:
        enabled: true

# Gateway API HTTPRoute for dashboard (private access only)
gateway-route:
  routes:
    - name: dashboard
      hostnames:
        - traefik.catfish-mountain.com
      service:
        name: traefik-dashboard
        port: 8080
