namespace: home-assistant

# Traefik IngressRoute for LAN access via mDNS (homeassistant.local)
# Routes through Traefik's MetalLB IP (192.168.0.200)
traefik:
  enabled: true
  hostname: homeassistant.local
  servicePort: 80

# Tailscale exposure for web UI
tailscale-ingress:
  enabled: true
  ingresses:
    - name: tailscale
      hostname: homeassistant
      service:
        name: home-assistant
        port: 80

home-assistant:
  # Enable host networking for device auto-discovery (mDNS, SSDP, etc.)
  # Required for discovering Kasa, Meross, SwitchBot, and other LAN devices
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet

  # Configuration management - enables trusted_proxies for reverse proxies (Tailscale + Traefik)
  configuration:
    enabled: true
    forceInit: false
    trusted_proxies:
      - 10.244.0.0/16  # Kubernetes pod CIDR (Tailscale and Traefik pods)
    templateConfig: |
      # Loads default set of integrations. Do not remove.
      default_config:

      # HTTP configuration for reverse proxy (Tailscale)
      http:
        use_x_forwarded_for: true
        trusted_proxies:
          {{- range .Values.configuration.trusted_proxies }}
          - {{ . }}
          {{- end }}

      # Load frontend themes from the themes folder
      frontend:
        themes: !include_dir_merge_named themes

  # Use StatefulSet for stable identity
  controller:
    type: StatefulSet

  # Persistent storage for configuration
  persistence:
    enabled: true
    storageClass: longhorn-emmc
    size: 10Gi
    accessMode: ReadWriteOnce

  # Service configuration
  # ClusterIP service - accessed via Traefik IngressRoute for LAN and Tailscale Ingress for remote
  service:
    type: ClusterIP
    port: 80

  # Prometheus metrics for SigNoz integration
  # Requires enabling the Prometheus integration in Home Assistant UI:
  # Settings -> Devices & Services -> Add Integration -> Prometheus
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8123"
    prometheus.io/path: "/api/prometheus"

# AirCast - AirPlay bridge for Chromecast devices
# Allows streaming audio from Apple devices to Chromecast speakers
# https://github.com/1activegeek/docker-airconnect
aircast:
  enabled: true
  image:
    repository: 1activegeek/airconnect
    tag: "1.9.3"
    pullPolicy: IfNotPresent

# Matter Server - Controller for Matter smart home devices
# Home Assistant connects via WebSocket at ws://localhost:5580/ws
# (localhost works because both HA and Matter Server use hostNetwork)
# https://github.com/home-assistant-libs/python-matter-server
matterServer:
  enabled: true
  image:
    # Image moved from home-assistant-libs to matter-js org
    repository: ghcr.io/matter-js/python-matter-server
    tag: "8.1.2"
    pullPolicy: IfNotPresent
  persistence:
    storageClass: longhorn-emmc
    size: 1Gi
